<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>canvas</title>
    <link rel="stylesheet" type="text/css" href="jquery-ui.css" />
    <style>
        .wrap {
            width: 600px;
            margin: 0 auto;
            text-align: center;
            position: relative;
        }
        #slider {
            /*width: 300px;*/
            margin-top: 50px;
            margin-left: auto;
            margin-right: auto;
        }
        input[type="text"] {
            width: 83px;
            height: 39px;
            font-size: 16px;
            border: 2px solid #5a6d7b;
            border-radius: 5px;
            text-align: center;
        }
        .left, .right {
            display: inline-block;
            vertical-align: top;
        }
        .left div {
            background: #ccc;
            width: 8px;
            height: 8px;
            margin: 0 auto;
            position: relative;
            border-radius: 50%;
        }
        .left div > div {
            font-size: 8px;
            position: absolute;
            background-color: red;
            border-bottom: 1px solid red;
            top: 4px;
            left: 3px;
            width: 2px;
            height: 3em;
            border-radius: 0;
            transform-origin: top center;
            animation: pendulum 3s infinite;
            animation-timing-function: cubic-bezier(0.8, 0, 0.2, 1);
        }
        .left div > div > div {
            font-size: 0.95em;
            top: 3.15789em;
            left: 0;
        }
        #dot {
            position: absolute;
        }
    </style>
</head>
<body>
<div class="wrap">
    <div class="left">
        <input type="text" disabled id="min" />

        <div id="dot"><div><div><div><div></div></div></div></div></div>
    </div>

    <div class="right">
        <input type="text" disabled id="max" />
    </div>

    <div id="slider"></div>
</div>

<div class="canvas-container">
    <canvas id="c" width="500" height="500" style="border: 1px solid;"></canvas>
</div>

<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="jquery-ui.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js"></script>
<script>
    $(function ()
    {
        $("#slider").slider({
            range: true,
            //step: 1,
            min: 0,
            max: 500,
            values: [ 75, 300 ],
            slide: function(event, ui)
            {
                $("#min").val("$" + ui.values[0]);
                $("#max").val("$" + ui.values[1]);

//                var fh = $('.ui-slider-handle:first').position().left
//                $("#dot").css("left", $('.ui-slider-handle:first').position().left)
                c.line1.animate('left', $('.ui-slider-handle:first').position().left, {
                    onChange: canvas.renderAll.bind(canvas),
                    duration: 1000,
                    easing: fabric.util.ease.easeOutBounce
                });
            }
        });

        $("#min").val("$" + $("#slider").slider("values", 0));
        $("#max").val("$" + $("#slider").slider("values", 1));
        $("#dot").css("left", $('.ui-slider-handle:first').position().left);
    });


    (function() {
        canvas = this.__canvas = new fabric.Canvas('c');
        fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';

        canvas.on({
            'object:selected': onObjectSelected,
            'object:moving': onObjectMoving,
            'before:selection:cleared': onBeforeSelectionCleared
        });

        (function drawQuadratic() {

            line = new fabric.Path('M 65 0 Q 100, 100, 200, 0', { fill: '', stroke: 'black' });

            line.path[0][1] = 100;
            line.path[0][2] = 100;

            line.path[1][1] = 200;
            line.path[1][2] = 200;

            line.path[1][3] = 300;
            line.path[1][4] = 100;

            line.selectable = false;
            canvas.add(line);

            p1 = makeCurvePoint(200, 200, null, line, null)
            p1.name = "p1";
            canvas.add(p1);

            // left circle
            p0 = makeCurveCircle(100, 100, line, p1, null);
            p0.name = "p0";
            canvas.add(p0);

            // right circle
            p2 = makeCurveCircle(300, 100, null, p1, line);
            p2.name = "p2";
            canvas.add(p2);

        })();

        function makeCurveCircle(left, top, line1, line2, line3) {
            c = new fabric.Circle({
                left: left,
                top: top,
                strokeWidth: 5,
                radius: 12,
                fill: '#fff',
                stroke: '#ccc'
            });

            c.hasBorders = c.hasControls = false;

            c.line1 = line1;
            c.line2 = line2;
            c.line3 = line3;

            return c;
        }


        function makeCurvePoint(left, top, line1, line2, line3) {
            c = new fabric.Circle({
//                left: left,
//                top: top,
//                strokeWidth: 8,
//                radius: 14,
//                fill: '#fff',
//                stroke: '#666'
            });

            //c.hasBorders = c.hasControls = false;

            //c.line1 = line1;
            //c.line2 = line2;
            //c.line3 = line3;

            return c;
        }

        function onObjectSelected(e) {
            activeObject = e.target;

            if (activeObject.name == "p0" || activeObject.name == "p2") {
                activeObject.line2.animate('opacity', '1', {
                    duration: 200,
                    onChange: canvas.renderAll.bind(canvas),
                });
                activeObject.line2.selectable = true;
            }
        }

        function onBeforeSelectionCleared(e) {
            activeObject = e.target;
            if (activeObject.name == "p0" || activeObject.name == "p2") {
                activeObject.line2.animate('opacity', '0', {
                    duration: 200,
                    onChange: canvas.renderAll.bind(canvas),
                });
                activeObject.line2.selectable = false;
            }
            else if (activeObject.name == "p1") {
                activeObject.animate('opacity', '0', {
                    duration: 200,
                    onChange: canvas.renderAll.bind(canvas),
                });
                activeObject.selectable = false;
            }
        }

        function onObjectMoving(e) {
            if (e.target.name == "p0" || e.target.name == "p2") {
                p = e.target;

                if (p.line1) {
                    p.line1.path[0][1] = p.left;
                    p.line1.path[0][2] = p.top;
                }
                else if (p.line3) {
                    p.line3.path[1][3] = p.left;
                    p.line3.path[1][4] = p.top;
                }
            }
            else if (e.target.name == "p1") {
                p = e.target;

                if (p.line2) {
                    p.line2.path[1][1] = p.left;
                    p.line2.path[1][2] = p.top;
                }
            }
            else if (e.target.name == "p0" || e.target.name == "p2") {
                p = e.target;

                p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });
                p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });
                p.line3 && p.line3.set({ 'x1': p.left, 'y1': p.top });
                p.line4 && p.line4.set({ 'x1': p.left, 'y1': p.top });
            }
        }


    })();
</script>
</body>
</html>